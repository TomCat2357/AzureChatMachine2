version: '3.2'
services:
  streamlit:
    container_name: 'streamlit'
    build: './docker/streamlit_docker/.'
    env_file:
      - ./docker/streamlit_docker/.env
    ports:
      - "8501:8501" # streamlit
    expose:
      - "8501"
    command: sh -c "tail -f /dev/null"
    depends_on:
      - apache
      - redis_6379
    volumes:
      - ./log:/root/log/
      - ./data/streamlit_data:/root/data/ 
      - ./docker/streamlit_docker:/root/docker/
    environment:
      - 'TZ=Asia/Tokyo'
    restart: always
  
  apache:
    container_name: 'apache'
    image: marvambass/apache2-ssl-secure:latest
    expose :
      - "443"
    ports : 
      - "443:443"
    volumes:
      - ./data/apache_data:/root/data/ 
      - ./docker/apache_docker:/root/docker/
    restart: always

  redis_6379:
    container_name: 'redis_6379'
    image: redis:latest
    ports:
      - "6379:6379"
    expose:
      - "6379"
    volumes:
      - ./data/redis_6379_snapshot/:/data/ # wsl2ç”¨
      - ./docker/redis_conf/6379/:/usr/local/etc/redis/
    command: ["redis-server", "/usr/local/etc/redis/redis.conf"]
    restart: always

